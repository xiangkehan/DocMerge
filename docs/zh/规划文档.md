# DocMerge 项目规划文档

## 一、项目概述

DocMerge 是一款专为知识要点大纲文档设计的智能去重与合并工具。该工具通过语义人工智能技术，能够自动识别多个 Word 文档中的重复内容，并将其智能融合为统一的文档结构。项目针对教育领域内容整理、知识库构建等场景，提供高效、准确的文档处理解决方案。

在技术实现层面，DocMerge 采用本地轻量级大语言模型与云端高级模型相结合的双层架构。本地模型负责快速的摘要提取和初步处理，确保用户数据的私密性；云端模型则承担复杂的语义分析和智能合并任务，提供高质量的输出结果。这种混合架构既保证了处理效率，又确保了合并质量，同时为不同需求的用户提供了灵活的使用选择。

## 二、核心功能

### 2.1 语义段落智能分割

语义段落分割是 DocMerge 的核心处理模块，负责将多个源文档分解为具有语义连贯性的段落结构。该功能支持单次处理最多 10 个 Word 文档，每个文档最大 20 页，总计约 200 页内容的处理能力。

处理流程首先对文档进行结构化解析，识别并提取文档中的各级标题、段落正文和图片元素。解析完成后，系统调用本地 Ollama 轻量级模型（qwen2.5:1.5B）对每个文本块生成语义摘要。这些摘要随后被组织为 3000 字符左右的窗口，为后续的智能分割提供语义边界参考。

在分割决策阶段，系统使用 DeepSeek V3 模型分析摘要窗口的语义连贯性，确定最优的分割点位置。获得分割点后，系统会回溯到原始文本，精确找到对应的文本边界，确保分割结果既符合语义逻辑，又保持原文的格式完整性。最终输出为具有标题层级关系的语义分段结构，每个分段都保留了其在原始文档中的上下文信息。

针对特殊场景，系统实现了完善的异常处理机制。空文档会被自动跳过处理，避免无效计算；文档中的图片元素会被准确定位并保留在相应位置，确保合并后文档的视觉完整性不受影响。

### 2.2 融合结果对比预览

融合对比预览模块为用户提供了直观的合并结果审核界面，采用左右分屏的设计布局。左侧展示参与融合的源文档内容，右侧展示 AI 生成的融合结果文档。这种并排对比的设计使用户能够快速验证融合效果，发现并修正可能存在的问题。

考虑到大文档的处理场景，系统实现了分页加载机制。当源文档或融合结果超出单屏显示范围时，系统会自动进行分页，用户可以通过翻页浏览完整内容。每个融合分段上方会显示其来源的 TOP 3 源文档标签，帮助用户追溯内容来源，理解融合逻辑。

在预览模式下，用户可以直接编辑融合后的文档内容。系统提供了完整的撤销重做功能，支持用户对修改操作进行灵活管理。所有编辑操作都会实时保存到新的文件中，原始源文档保持完全不变，确保数据安全。用户在确认融合结果后，可以选择导出编辑后的最终文档。

### 2.3 用户密钥安全存储

针对用户 API 密钥的管理需求，DocMerge 根据不同的运行平台提供了差异化的存储方案。存储策略的设计原则是在便利性与安全性之间取得最佳平衡。

桌面应用程序采用本地文件存储方式，密钥以明文形式保存在本地配置文件中。这种方式便于用户管理，但系统会在首次使用时显示明确的风险提示，提醒用户妥善保管本地文件。Web 版本的 Streamlit 应用则将密钥存储在 Supabase 云端数据库中，同样会在保存时显示风险警告，强调云端存储的潜在安全考量。CLI 版本不提供密钥存储功能，用户每次使用都需要手动输入 API 密钥。

存储路径遵循各操作系统的标准配置规范。Windows 系统存储在 `%APPDATA%\DocMerge\keys.json` 路径；macOS 系统存储在 `~/Library/Application Support/DocMerge/keys.json` 路径；Linux 系统存储在 `~/.config/DocMerge/keys.json` 路径。这种统一的命名规范和平台适配确保了跨平台使用的一致性体验。

### 2.4 多格式输出支持

DocMerge 提供了丰富的输出格式支持，在第一开发阶段支持 Word 文档（.docx）和 Markdown（.md）两种主流格式。输出文档能够完整保留原始文档的格式信息，包括多级标题的层级结构、文本的加粗和斜体样式、以及文档中嵌入的图片元素。

文件名由 AI 根据文档内容自动生成，体现文档的核心主题。用户可以在导出前对文件名进行编辑修改，满足个性化的命名需求。不同格式的文件支持独立下载，不提供打包压缩功能，简化了用户的下载操作流程。

## 三、系统架构

DocMerge 采用模块化的微服务架构设计，整个系统由四个独立的功能模块组成，各自承担明确职责，通过标准接口进行协作。

**docmergecore** 是系统的 Python 核心库，封装了文档解析、语义分析、智能分割、内容融合等核心算法。该模块是整个系统的基础，为其他所有模块提供统一的功能接口。核心库的设计注重可测试性和可复用性，每个功能模块都可以独立调用。

**docmerge-api** 是基于 FastAPI 框架构建的 REST API 服务，为前端应用提供标准化的接口访问能力。API 服务负责接收请求、调用核心库功能、返回处理结果，支持异步处理模式以应对大文档的长时间计算场景。

**docmerge-web** 是基于 Streamlit 框架开发的 Web 用户界面，提供浏览器访问的图形化操作体验。Web 应用通过调用 docmerge-api 提供的接口实现功能调用，专注于用户交互体验的优化。

**docmerge-desktop** 是基于 Tauri 框架开发的桌面应用程序，目前处于规划阶段。桌面应用将提供更原生的系统集成体验和更好的离线支持，是未来版本的重要发展方向。

## 四、用户策略

### 4.1 使用配额管理

DocMerge 采用分层的用户配额体系，区分匿名用户和登录用户的使用权限。匿名用户每日可以使用 3 次完整的文档融合功能，这一配额足以满足轻度用户的试用需求。登录用户则享有更高的使用配额，单次任务处理时间限制为 2 分钟，文档大小限制为 10 页，确保系统资源能够服务更多用户。

### 4.2 任务历史管理

用户的任务历史记录默认保存 90 天，支持云端同步功能。登录用户可以在不同设备间访问自己的历史任务记录，便于持续的项目管理和进度追踪。历史记录的云端同步依赖于 Supabase 数据库服务，确保数据的一致性和持久性。

### 4.3 功能访问分级

系统的功能访问采用分级开放策略。完全本地化的功能（如本地 Ollama 模型调用、匿名使用模式）无需用户登录即可使用，为注重隐私的用户提供便利。涉及云端 AI 服务（如 DeepSeek API 调用）的功能则需要用户登录后使用，确保 API 密钥的安全管理和使用计费的准确性。

## 五、人工智能服务提供商

### 5.1 本地模型

本地运行的人工智能模型基于 Ollama 平台部署，目前支持 qwen2.5 和 llama3 系列模型。这些轻量级模型在消费级硬件上即可流畅运行，主要负责文档摘要提取和语义相似度计算等预处理任务。本地模型的优势在于响应速度快、无网络依赖、用户数据完全保留在本地，满足隐私敏感型用户的需求。

### 5.2 云端模型

云端高级模型采用 DeepSeek V3，该模型具备 128K 的上下文窗口长度，能够处理超长文档的语义分析任务。DeepSeek V3 主要承担智能分割点判断和内容融合生成等高复杂度计算任务，其强大的语义理解能力确保了融合结果的准确性和流畅性。云端模型通过标准 API 接口调用，使用前需要用户在设置中配置有效的 API 密钥。

## 六、认证与数据库

### 6.1 Supabase 平台

DocMerge 选择 Supabase 作为后端即服务（BaaS）平台，充分利用其提供的认证服务、数据库存储和文件存储等基础设施能力。Supabase 的免费层级提供每月 50,000 月活跃用户、500MB 数据库空间和 1GB 文件存储的配额，对于中小规模用户群体完全足够。

### 6.2 认证方式

系统支持多种认证方式以适应不同用户的使用习惯。匿名认证允许用户无需注册即可使用基础功能，降低了使用门槛。邮箱密码认证则为需要长期使用的用户提供标准账户体系，支持密码找回等常规功能。未来版本规划支持更多的第三方账号登录选项。

### 6.3 自托管选项

考虑到企业用户的私有化部署需求，Supabase 平台支持完全的自托管部署模式。用户可以在自己的服务器上搭建完整的 Supabase 实例，实现数据的完全自主管理。这一选项将在后续版本中提供详细的部署文档和技术支持。

## 七、技术栈详情

### 7.1 编程语言与核心库

系统主体采用 Python 3.10 及以上版本开发，充分利用 Python 生态在自然语言处理领域的丰富工具链。python-docx 库负责 Word 文档的读写操作，支持文档结构和格式信息的完整保留。sentence-transformers 库提供句子级别的语义向量计算能力，选用 all-MiniLM-L6-v2 模型作为默认的嵌入模型，在准确性和效率之间取得良好平衡。

### 7.2 人工智能框架

本地大语言模型调用通过 Ollama 平台实现，该平台提供了简洁的模型管理和 API 调用接口。云端大语言模型调用通过 DeepSeek 官方 API 实现，支持流式输出和标准 REST 调用两种模式。两种调用方式在核心库中进行了统一的抽象封装，上层应用无需感知底层差异。

### 7.3 用户界面

Web 用户界面采用 Streamlit 框架开发，该框架专为数据科学应用设计，能够快速构建交互式的数据处理界面。Streamlit 的组件化开发模式简化了复杂交互逻辑的实现，同时提供了良好的响应式布局支持。桌面应用程序规划采用 Tauri 框架结合 Python 后端的技术路线，利用 Tauri 的跨平台能力和原生性能优势。

### 7.4 后端服务

API 服务采用 FastAPI 框架构建，该框架以其高性能和自动生成 API 文档的特性著称。FastAPI 的异步支持能力确保了长时间运行的任务不会阻塞服务响应，配合后台任务队列可以进一步优化大文档的处理体验。数据库操作通过 Supabase Python 客户端实现，简化了认证和存储功能的集成工作。

## 八、总结

DocMerge 项目旨在为知识文档的整理和融合提供智能化的解决方案。通过语义人工智能技术，系统能够自动识别重复内容并生成高质量的合并结果，大幅提升文档处理效率。模块化的系统架构确保了各功能组件的独立演进能力，分层的技术选型在性能和成本之间取得了良好平衡。项目规划覆盖了桌面、Web、CLI 多端平台，致力于为不同使用场景的用户提供一致的高质量体验。